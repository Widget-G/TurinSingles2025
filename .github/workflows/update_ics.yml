name: Auto Update ATP Finals 2025 ICS

on:
  schedule:
    - cron: "0 */6 * * *"  # ‚è∞ co 6 godzin
  workflow_dispatch:       # ‚ûï rƒôczne uruchomienie

jobs:
  update-ics:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install icalendar requests beautifulsoup4 pytz

      - name: Generate updated ICS
        run: |
          echo "üîÑ Generowanie nowego pliku ATP Finals 2025..."
          python generate_ics.py

      - name: Test ICS file
        run: |
          if [ ! -f output/ATP_Finals_2025_Singles_Turin.ics ]; then
            echo "‚ùå Plik ICS nie zosta≈Ç wygenerowany!"
            exit 1
          else
            echo "‚úÖ Plik ICS wygenerowany poprawnie."
          fi

      - name: Commit and push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add output/ATP_Finals_2025_Singles_Turin.ics || echo "‚ö†Ô∏è Brak zmian do dodania"
          git commit -m "Auto-update ATP Finals 2025 schedule" --allow-empty || echo "‚ö†Ô∏è Brak zmian do commitowania"
          git push || echo "‚úÖ Repozytorium jest aktualne"

      - name: Send Push Notification (ntfy)
        if: success()  # tylko je≈õli wszystko posz≈Ço dobrze
        run: |
          curl -H "Title: üéæ ATP Finals 2025 Update" \
               -H "Priority: 4" \
               -H "Tags: tennis,calendar,rocket" \
               -d "Nowy plan mecz√≥w zosta≈Ç opublikowany i Tw√≥j kalendarz .ics zosta≈Ç zaktualizowany! üìÖ" \
               https://ntfy.sh/kgforce_atp2025
